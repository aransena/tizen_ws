<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<title>Hello TAU</title>
		<link rel="stylesheet" href="lib/tau/wearable/theme/default/tau.css"/>
		<link rel="stylesheet" media="all" href="lib/tau/wearable/theme/default/tau.circle.min.css">
		<!--load theme file for your application-->
		<link rel="stylesheet"href="css/style.css"/>
	</head>
	<body>
	
	<div class="ui-page ui-page-active" id="robotControl">
	   <div class="ui-content">
	   </div>
   <footer class="ui-footer ui-bottom-button">
      <a href="" class="ui-btn" id="btn-Send">Send</a>
   </footer>
	  
	<script>
	var ws='';
	var url= window.localStorage.getItem('url').toString();	
	console.log("connecting to: "+url);  		  
	ws = new WebSocket(url);
	
	var ev = document.getElementById("btn-Send");
	
	ev.addEventListener("click", function ()
	{
		if(ws.readyState==1){
			ws.send("Hello");
			console.log("Button Press");
		}
	});
	

	////////// Websocket related functions /////////
	ws.onopen = function() {
		ws.send('Ping'); // Send the message 'Ping' to the server
	};
	ws.onclose = function() {
		
	};
	ws.onmessage = function(msg) {
		console.log(msg); // Send the message 'Ping' to the server
	};
	ws.onerror = function () {
		console.error("Websocket Error!");
	};
	///////////////////////////////////////////////
	
	
	//////////////////Events//////////////////////
	
	// Rotary Events //
    var rotaryEventHandler = function(e)
    {
        var ev_time=tizen.time.getCurrentDateTime().getSeconds()+"."+tizen.time.getCurrentDateTime().getMilliseconds();
       if (e.detail.direction === "CW")
       {
    	   console.log("Rotate CW:\t'"+ ev_time);
    	   ws.send("CW\t"+ev_time);
       }
       else if (e.detail.direction === "CCW") 
       {
    	   console.log("Rotate CCW:\t"+tizen.time.getCurrentDateTime().getMilliseconds());
    	   ws.send("CCW\t"+ev_time);
       }
    };
	document.addEventListener("rotarydetent", rotaryEventHandler, false);	
	
	////// Touch Events //////
	
	// Screen Touch //
    document.addEventListener("click", function(){
		if(ws.readyState==1){
			ws.send("Screen Press");
			console.log("Screen Press");
		}
	});

    var multiTouchHandler = function(e){
    	if(ws.readyState==1){
			e.preventDefault();	
			var touchCount = e.touches.length;
			console.log("touches: " + touchCount);
			ws.send("Touches: " + touchCount);
			
			switch(e.touches.length){
			case 2:
	    		console.log("2 finger press");
	    		ws.send("Two Finger Press");
				break;
			case 1:
	    		console.log("1 finger press");
	    		ws.send("One Finger Press");
				break;
	
			default:
	    		console.log("Error");
	    		ws.send("Unknown");
				break;
			}
    	}
    	else{
        	console.log("Websocket not ready for touch event");
        	}
		

    }
    var endTouchHandler = function(e){
    	if(ws.readyState==1){
        	ws.send("End Touch");
        	console.log("End Touch");
      	}
    	else{
        	console.log("Websocket not ready for touch event");
        	}
    }
    
    
    document.addEventListener('touchstart', multiTouchHandler, false);
    //document.addEventListener('touchmove', multiTouchHandler, false);
    document.addEventListener('touchend', endTouchHandler, false);
		
   </script>
   
   
	</div>
	<script src="app.js"></script>
	
	</body>
</html>